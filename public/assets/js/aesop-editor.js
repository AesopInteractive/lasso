(function(a,b){"use strict";var c=function(){var c,d=a.rangy||null,e=a.Undo||null,f=!d||!e,g=a.Key={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,pageUp:33,pageDown:34,end:35,home:36,leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,insert:45,"delete":46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindow:91,rightWindowKey:92,select:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numLock:144,scrollLock:145,semiColon:186,equalSign:187,comma:188,dash:189,period:190,forwardSlash:191,graveAccent:192,openBracket:219,backSlash:220,closeBraket:221,singleQuote:222},h=function(b){var d,e,i,j,k=this,l=new h.Action,m=new h.Cache,n=new h.Cursor,o=new h.Selection,p={focus:function(b){b=b||a.event,h.activeElement=d,k.placeholders()},blur:function(b){b=b||a.event,h.activeElement===d&&(h.activeElement=null),k.placeholders()},down:function(b){b=b||a.event;var d=!0;if(229!==b.keyCode){if(c.isCommand(r,b,function(){m.cmd=!0},function(){m.cmd=!1}),c.isShift(b,function(){m.shift=!0},function(){m.shift=!1}),c.isModifier(r,b,function(a){if(m.cmd){if((r.mode===h.inlineMode||r.mode===h.partialMode)&&"paste"!==a)return void c.preventDefaultEvent(b);var e=typeof a,f=null;f="function"===e?a:p.command[a],d=f.call(k,b),d===!1&&(c.preventDefaultEvent(b),c.stopPropagation(b))}}),-1!==r.maxLength){var e=c.text().length,f=!1,i=a.getSelection();if(i&&(f=!i.isCollapsed),e>=r.maxLength&&!c.isSpecial(b)&&!c.isNavigational(b)&&!f)return r.maxLengthReached(r.element),c.preventDefaultEvent(b)}switch(b.keyCode){case g.enter:p.enterKey(b);break;case g.backspace:case g["delete"]:p.backspaceOrDeleteKey(b)}return d}},up:function(b){b=b||a.event,c.isCommand(r,b,function(){m.cmd=!1},function(){m.cmd=!0}),k.clean(),k.placeholders();var d;if(null!==r.keyContext&&(d=r.keyContext[b.keyCode])){var e=n.parent();e&&d.call(k,b,e)}l.preserveElementFocus()},command:{bold:function(a){c.preventDefaultEvent(a),new h.Element(k,"bold").setClean(!1).invoke(r.beforeInvokeElement)},underline:function(a){c.preventDefaultEvent(a),new h.Element(k,"underline").setClean(!1).invoke(r.beforeInvokeElement)},italicize:function(a){c.preventDefaultEvent(a),new h.Element(k,"italic").setClean(!1).invoke(r.beforeInvokeElement)},quote:function(){},paste:function(){if(k.makeUndoable(),r.pasteAsText){var a=c.selection.saveSelection();c.pasteHook(function(b){c.selection.restoreSelection(a),b=b.replace(/\n/g,"<br>"),new h.Html(k,b).setClean(!1).insert(r.beforeInsertHtml,!0),k.clean(),k.placeholders()})}else k.clean(),k.placeholders()}},enterKey:function(a){if(r.mode===h.inlineMode||r.mode===h.inlineRichMode)return c.preventDefaultEvent(a);if(m.shift){if(r.tags["break"])return c.preventDefaultEvent(a),k.addTag(r.tags["break"],!0),!1}else{var b,e,f,g=c.atCaret(k)||{},i=d.children,j=g===d.lastChild?d.lastChild:null;j&&j!==d.firstChild&&r.autoHR&&"partial"!==r.mode&&r.tags.horizontalRule&&(c.preventDefaultEvent(a),b=""===c.text(j)&&j.nodeName.toLowerCase()===r.tags.paragraph,b&&i.length>=2&&(e=i[i.length-2],e.nodeName.toLowerCase()===r.tags.horizontalRule&&(b=!1)),b&&(k.addTag(r.tags.horizontalRule,!1,!0,g),g=g.nextSibling),null!==(f=k.addTag(r.tags.paragraph,!0,null,g))&&(f.innerHTML="",n.set(k,0,f)))}return!0},backspaceOrDeleteKey:function(a){if(void 0!==r.onBackspaceOrDelete){var b=r.onBackspaceOrDelete.call(k,a,d);if(b)return}if(null!==d.lastChild){var e=d.lastChild,f=e.previousSibling;e&&r.tags.horizontalRule&&e.nodeName.toLocaleLowerCase()===r.tags.horizontalRule?d.removeChild(e):e&&f&&c.text(e).length<1&&f.nodeName.toLowerCase()===r.tags.horizontalRule&&e.nodeName.toLowerCase()===r.tags.paragraph&&(d.removeChild(e),d.removeChild(f))}}},q={element:null,modifier:"auto",placeholder:"",autofocus:!1,autoHR:!0,mode:h.richMode,maxLength:-1,modifiers:{b:"bold",i:"italicize",u:"underline",v:"paste"},tags:{"break":"br",horizontalRule:"hr",paragraph:"p",outerLevel:["pre","blockquote","figure"],innerLevel:["a","b","u","i","img","strong"]},cssClasses:{editor:"Medium",pasteHook:"Medium-paste-hook",placeholder:"Medium-placeholder",clear:"Medium-clear"},attributes:{remove:["style","class"]},pasteAsText:!0,beforeInvokeElement:function(){},beforeInsertHtml:function(){},maxLengthReached:function(){},beforeAddTag:function(){},keyContext:null,pasteEventHandler:function(b){b=b||a.event,k.makeUndoable();var e,f=k.value().length;if(r.pasteAsText){c.preventDefaultEvent(b);var g=c.selection.saveSelection(),i=prompt(h.Messages.pastHere)||"";if(i.length>0)return d.focus(),h.activeElement=d,c.selection.restoreSelection(g),i=c.encodeHtml(i),e=i.length+f,r.maxLength>0&&e>r.maxLength&&(i=i.substring(0,r.maxLength-f)),r.mode!==h.inlineMode&&(i=i.replace(/\n/g,"<br>")),new h.Html(k,i).setClean(!1).insert(r.beforeInsertHtml,!0),k.clean(),k.placeholders(),!1}else setTimeout(function(){k.clean(),k.placeholders()},20)},drag:!1},r=c.deepExtend(q,b),s={};for(i in q)q.hasOwnProperty(i)&&"object"!=typeof q[i]&&q.hasOwnProperty(i)&&r.element.getAttribute("data-medium-"+g)&&(e=r.element.getAttribute("data-medium-"+g),("false"===e.toLowerCase()||"true"===e.toLowerCase())&&(e="true"===e.toLowerCase()),r[i]=e);if(r.modifiers)for(i in r.modifiers)"undefined"!=typeof g[i]&&(r.modifiers[g[i]]=r.modifiers[i]);if(r.keyContext)for(i in r.keyContext)"undefined"!=typeof g[i]&&(r.keyContext[g[i]]=r.keyContext[i]);d=r.element,d.contentEditable=!0,d.className+=" "+r.cssClasses.editor+(" "+r.cssClasses.editor+"-"+r.mode),r.tags=r.tags||{},r.tags.outerLevel&&(r.tags.outerLevel=r.tags.outerLevel.concat([r.tags.paragraph,r.tags.horizontalRule])),this.settings=r,this.element=d,this.intercept=p,this.action=l,this.cache=m,this.cursor=n,this.utils=c,this.selection=o,s.element=d,s.medium=this,s.settings=r,s.action=l,s.cache=m,s.cursor=n,s.intercept=p,s.utils=c,s.selection=o,l.setBridge(s),m.setBridge(s),n.setBridge(s),o.setBridge(s),k.clean(),k.placeholders(),l.preserveElementFocus(),l.listen(),f?this.makeUndoable=function(){}:(this.dirty=!1,this.undoable=new h.Undoable(this),this.undo=this.undoable.undo,this.redo=this.undoable.redo,this.makeUndoable=this.undoable.makeUndoable),r.drag&&(j=k.drag=new h.Drag(k),c.addEvent(d,"mousemove",function(b){b=b||a.event;var c=b.target||{};"false"===c.getAttribute("contenteditable")&&j.show(c)})),d.medium=this,m.initialized=!0};return h.prototype={placeholders:function(){if(a.getComputedStyle){var d=this.settings,e=this.placeholder||(this.placeholder=b.createElement("div")),f=this.element,g=e.style,i=a.getComputedStyle(f,null),j=function(a){return i.getPropertyValue(a)},k=c.text(f),l=this.cursor,m=f.children.length,n=h.activeElement===f;if(f.placeholder=e,!n&&k.length<1&&2>m){if(f.placeHolderActive)return;f.innerHTML.match("<"+d.tags.paragraph)||(f.innerHTML=""),d.placeholder.length>0&&(e.setup||(e.setup=!0,g.background=j("background"),g.backgroundColor=j("background-color"),g.fontSize=j("font-size"),g.color=i.color,g.marginTop=j("margin-top"),g.marginBottom=j("margin-bottom"),g.marginLeft=j("margin-left"),g.marginRight=j("margin-right"),g.paddingTop=j("padding-top"),g.paddingBottom=j("padding-bottom"),g.paddingLeft=j("padding-left"),g.paddingRight=j("padding-right"),g.borderTopWidth=j("border-top-width"),g.borderTopColor=j("border-top-color"),g.borderTopStyle=j("border-top-style"),g.borderBottomWidth=j("border-bottom-width"),g.borderBottomColor=j("border-bottom-color"),g.borderBottomStyle=j("border-bottom-style"),g.borderLeftWidth=j("border-left-width"),g.borderLeftColor=j("border-left-color"),g.borderLeftStyle=j("border-left-style"),g.borderRightWidth=j("border-right-width"),g.borderRightColor=j("border-right-color"),g.borderRightStyle=j("border-right-style"),e.className=d.cssClasses.placeholder+" "+d.cssClasses.placeholder+"-"+d.mode,e.innerHTML="<div>"+d.placeholder+"</div>",f.parentNode.insertBefore(e,f)),f.className+=" "+d.cssClasses.clear,g.display="",g.minHeight=f.clientHeight+"px",g.minWidth=f.clientWidth+"px",d.mode!==h.inlineMode&&d.mode!==h.inlineRichMode&&(this.setupContents(),0===m&&f.firstChild&&l.set(this,0,f.firstChild))),f.placeHolderActive=!0}else f.placeHolderActive&&(f.placeHolderActive=!1,g.display="none",f.className=c.trim(f.className.replace(d.cssClasses.clear,"")),this.setupContents())}},clean:function(b){{var d,e,f,g=this.settings,i=g.cssClasses.placeholder,j=(g.attributes||{}).remove||[],k=g.tags||{},l=k.outerLevel||null,m=k.innerLevel||null,n={},o={},p=(k.paragraph||"").toUpperCase();this.html}if(b=b||g.element,g.mode===h.inlineRichMode&&(l=g.tags.innerLevel),null!==l)for(f=0;f<l.length;f++)n[l[f].toUpperCase()]=!0;if(null!==m)for(f=0;f<m.length;f++)o[m[f].toUpperCase()]=!0;c.traverseAll(b,{element:function(b,g,h,k){var q=b.nodeName,r=!0;for(f=0;f<j.length;f++)d=j[f],b.hasAttribute(d)&&b.getAttribute(d)!==i&&b.removeAttribute(d);if((null!==l||null!==m)&&(1===h&&void 0!==n[q]?r=!1:h>1&&void 0!==o[q]&&(r=!1),r))if("block"===a.getComputedStyle(b,null).getPropertyValue("display")){if(p.length>0&&p!==q&&c.changeTag(b,p),h>1)for(;k.childNodes.length>g;)k.parentNode.insertBefore(k.lastChild,k.nextSibling)}else switch(q){case"BR":if(b===b.parentNode.lastChild){if(b===b.parentNode.firstChild)break;e=document.createTextNode(""),e.innerHTML="&nbsp",b.parentNode.insertBefore(e,b);break}default:for(;null!==b.firstChild;)b.parentNode.insertBefore(b.firstChild,b);c.detachNode(b)}}})},insertHtml:function(a,b,d){var e=new h.Html(this,a).insert(this.settings.beforeInsertHtml);return d===!0&&c.triggerEvent(this.element,"change"),b&&b.apply(e),this},addTag:function(a,c,d,e){if(!this.settings.beforeAddTag(a,c,d,e)){var f,g=b.createElement(a);return"undefined"!=typeof d&&d===!1&&(g.contentEditable=!1),0==g.innerHTML.length&&(g.innerHTML=" "),e&&e.nextSibling?(e.parentNode.insertBefore(g,e.nextSibling),f=e.nextSibling):(this.element.appendChild(g),f=this.lastChild()),c&&(this.cache.focusedElement=f,this.cursor.set(this,0,f)),g}return null},invokeElement:function(a,b,d){var e=this.settings,b=b||{},f=b.remove||[];switch(e.mode){case h.inlineMode:case h.partialMode:return this}return f.length>0&&(c.arrayContains(e,"class")||f.push("class")),new h.Element(this,a,b).invoke(this.settings.beforeInvokeElement),d===!0&&c.triggerEvent(this.element,"change"),this},behavior:function(){return f?h.wildBehavior:h.domesticatedBehavior},value:function(a){return"undefined"==typeof a?this.element.innerHTML:(this.element.innerHTML=a,this.clean(),this.placeholders(),this)},focus:function(){var a=this.element;return a.focus(),this},select:function(){var c,d,e=this.element;return e.focus(),b.body.createTextRange?(c=b.body.createTextRange(),c.moveToElementText(e),c.select()):a.getSelection&&(d=a.getSelection(),c=b.createRange(),c.selectNodeContents(e),d.removeAllRanges(),d.addRange(c)),this},isActive:function(){return h.activeElement===this.element},setupContents:function(){var a,c=this.element,d=c.children,e=c.childNodes,f=this.settings;return!f.tags.paragraph||d.length>0||f.mode===h.inlineMode||f.mode===h.inlineRichMode?h.Utilities:(e.length>0?(a=b.createElement(f.tags.paragraph),c.innerHTML.match("^[&]nbsp[;]")&&(c.innerHTML=c.innerHTML.substring(6,c.innerHTML.length-1)),a.innerHTML=c.innerHTML,c.innerHTML="",c.appendChild(a),this.cursor.set(this,a.innerHTML.length,a)):(a=b.createElement(f.tags.paragraph),a.innerHTML="&nbsp;",c.appendChild(a)),this)},destroy:function(){var a=this.element,b=this.intercept,d=this.settings,e=this.placeholder||null;null!==e&&e.setup&&(e.parentNode.removeChild(e),delete a.placeHolderActive),a.removeAttribute("contenteditable"),a.className=c.trim(a.className.replace(d.cssClasses.editor,"").replace(d.cssClasses.clear,"").replace(d.cssClasses.editor+"-"+d.mode,"")),c.removeEvent(a,"keyup",b.up).removeEvent(a,"keydown",b.down).removeEvent(a,"focus",b.focus).removeEvent(a,"blur",b.focus).removeEvent(a,"paste",d.pasteEventHandler)},clear:function(){this.element.innerHTML="",this.placeholders()},splitAtCaret:function(){if(!this.isActive())return null;var c,d=a.getSelection||b.selection,e=d(),f=e.focusOffset,g=e.focusNode,h=this.element,i=b.createRange(),j=b.createRange();return i.setStart(g,f),j.selectNodeContents(h),i.setEnd(j.endContainer,j.endOffset),c=i.extractContents()},deleteSelection:function(){if(this.isActive()){var a,b=d.getSelection();b.rangeCount>0&&(a=b.getRangeAt(0),a.deleteContents())}},lastChild:function(){return this.element.lastChild}},h.Element=function(a,b,c){if(this.medium=a,this.element=a.settings.element,f)this.tagName=b;else switch(b.toLowerCase()){case"bold":this.tagName="b";break;case"italic":this.tagName="i";break;case"underline":this.tagName="u";break;default:this.tagName=b}this.attributes=c||{},this.clean=!0},h.Html=function(a){this.medium=a,this.element=a.settings.element,this.clean=!0},h.Injector=function(){},f?(h.Element.prototype={invoke:function(a){h.activeElement===this.element&&(a&&a.apply(this),b.execCommand(this.tagName,!1))},setClean:function(){return this}},h.Injector.prototype={inject:function(a,b){return this.insertHTML(a,b),null}},h.Undoable=function(){}):(d.rangePrototype.insertNodeAtEnd=function(a){var b=this.cloneRange();b.collapse(!1),b.insertNode(a),b.detach(),this.setEndAfter(a)},h.Element.prototype={invoke:function(b){if(h.activeElement===this.element){b&&b.apply(this);var c,e,f=this.attributes,g=this.tagName.toLowerCase();void 0!==f.className?(e=(f.className.split[" "]||[f.className]).shift(),delete f.className):e="medium-"+g,c=d.createClassApplier(e,{elementTagName:g,elementAttributes:this.attributes}),this.medium.makeUndoable(),c.toggleSelection(a),this.clean&&(this.medium.clean(),this.medium.placeholders())}},setClean:function(a){return this.clean=a,this}},h.Injector.prototype={inject:function(a){var c,d=!1;if("string"==typeof a){var e=b.createElement("div");e.innerHTML=a,c=e.childNodes,d=!0}else c=a;this.insertHTML('<span id="wedge"></span>');var f=b.getElementById("wedge"),g=f.parentNode,h=0;if(f.removeAttribute("id"),d)for(;h<c.length;)g.insertBefore(c[h],f);else g.insertBefore(c,f);return g.removeChild(f),f=null,c}},h.Undoable=function(a){var b,d=this,e=a.settings.element,f=e.innerHTML,h=new Undo.Stack,i=Undo.Command.extend({constructor:function(a,b){this.oldValue=a,this.newValue=b},execute:function(){},undo:function(){e.innerHTML=this.oldValue,a.canUndo=h.canUndo(),a.canRedo=h.canRedo(),a.dirty=h.dirty()},redo:function(){e.innerHTML=this.newValue,a.canUndo=h.canUndo(),a.canRedo=h.canRedo(),a.dirty=h.dirty()}}),j=function(){var b=e.innerHTML;b!=f&&(d.movingThroughStack||(h.execute(new i(f,b)),f=b,a.dirty=h.dirty()),c.triggerEvent(a.settings.element,"change"))};this.medium=a,this.timer=b,this.stack=h,this.makeUndoable=j,this.EditCommand=i,this.movingThroughStack=!1,c.addEvent(e,"keyup",function(a){return a.ctrlKey||a.keyCode===g.z?void c.preventDefaultEvent(a):(clearTimeout(b),void(b=setTimeout(function(){j()},250)))}).addEvent(e,"keydown",function(a){return a.ctrlKey&&a.keyCode===g.z?(c.preventDefaultEvent(a),d.movingThroughStack=!0,void(a.shiftKey?h.canRedo()&&h.redo():h.canUndo()&&h.undo())):(d.movingThroughStack=!1,!0)})}),h.Injector.prototype.insertHTML=function(c,d){var e,f;if(a.getSelection){if(e=a.getSelection(),e.getRangeAt&&e.rangeCount){f=e.getRangeAt(0),f.deleteContents();var g=b.createElement("div");g.innerHTML=c;for(var h,i,j=b.createDocumentFragment();h=g.firstChild;)i=j.appendChild(h);var k=j.firstChild;f.insertNode(j),i&&(f=f.cloneRange(),f.setStartAfter(i),d?f.setStartBefore(k):f.collapse(!0),e.removeAllRanges(),e.addRange(f))}}else if((e=b.selection)&&"Control"!=e.type){var l=e.createRange();l.collapse(!0),e.createRange().pasteHTML(c),d&&(f=e.createRange(),f.setEndPoint("StartToStart",l),f.select())}},h.Html.prototype={insert:function(a,b){if(h.activeElement===this.element){a&&a.apply(this);var c=this.injector.inject(this.html,b);return this.clean&&(this.medium.clean(),this.medium.placeholders()),this.medium.makeUndoable(),c}return null},injector:new h.Injector,setClean:function(a){return this.clean=a,this}},h.Utilities=c={isCommand:function(a,b,c,d){return"ctrl"===a.modifier&&b.ctrlKey||"cmd"===a.modifier&&b.metaKey||"auto"===a.modifier&&(b.ctrlKey||b.metaKey)?c.call():d.call()},isShift:function(a,b,c){return a.shiftKey?b.call():c.call()},isModifier:function(a,b,c){var d=a.modifiers[b.keyCode];return d?c.call(null,d):!1},special:function(){var a={};return a[g.backspace]=!0,a[g.shift]=!0,a[g.ctrl]=!0,a[g.alt]=!0,a[g["delete"]]=!0,a[g.cmd]=!0,a}(),isSpecial:function(a,b){return a?!0:"undefined"!=typeof h.Utilities.special[b.keyCode]},navigational:function(){var a={};return a[g.upArrow]=!0,a[g.downArrow]=!0,a[g.leftArrow]=!0,a[g.rightArrow]=!0,a}(),isNavigational:function(a){return"undefined"!=typeof h.Utilities.navigational[a.keyCode]},addEvents:function(a,b,c){for(var d,e=0,f=b.split(" "),g=f.length,i=h.Utilities;g>e;e++)d=f[e],d.length>0&&i.addEvent(a,d,c);return h.Utilities},addEvent:function(a,b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c,h.Utilities},removeEvent:function(a,b,c){return a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null,h.Utilities},preventDefaultEvent:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,h.Utilities},stopPropagation:function(a){return a=a||window.event,a.cancelBubble=!0,void 0!==a.stopPropagation&&a.stopPropagation(),h.Utilities},isEventSupported:function(a,c){c="on"+c;var d=b.createElement(a.tagName),e=c in d;return e||(d.setAttribute(c,"return;"),e="function"==typeof d[c]),d=null,e},triggerEvent:function(a,c){var d;return b.createEvent?(d=b.createEvent("HTMLEvents"),d.initEvent(c,!0,!0),d.eventName=c,a.dispatchEvent(d)):(d=b.createEventObject(),a.fireEvent("on"+c,d)),h.Utilities},deepExtend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},h.Utilities.deepExtend(a[c],b[c])):a[c]=b[c]);return a},pasteHook:function(a,d){{var e,g,i,j=b.createElement("textarea"),k=a.element,l=a.settings;a.html}return j.className=l.cssClasses.pasteHook,k.parentNode.appendChild(j),j.focus(),f||a.makeUndoable(),setTimeout(function(){k.focus(),l.maxLength>0&&(e=c.text(k),g=e.length,i=g+j.value.length,i>g&&(j.value=j.value.substring(0,l.maxLength-g))),d(j.value),c.detachNode(j)},2),h.Utilities},traverseAll:function(a,b,c){var d,e=a.childNodes,f=e.length,g=0,c=c||1;if(b=b||{},f>0)for(;f>g;g++){switch(d=e[g],d.nodeType){case 1:h.Utilities.traverseAll(d,b,c+1),void 0!==b.element&&b.element(d,g,c,a);break;case 3:void 0!==b.fragment&&b.fragment(d,g,c,a)}f=e.length,d===a.lastChild&&(g=f)}return h.Utilities},trim:function(a){return a.replace(/^[\s]+|\s+$/g,"")},arrayContains:function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},addClass:function(a,b){return a.classList?a.classList.add(b):a.className+=" "+b,h.Utilities},removeClass:function(a,b){return a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," "),h.Utilities},hasClass:function(a,b){return a.classList?a.classList.contains(b):new RegExp("(^| )"+b+"( |$)","gi").test(a.className)},isHidden:function(a){return 0===a.offsetWidth||0===a.offsetHeight},isVisible:function(a){return 0!==a.offsetWidth||0!==a.offsetHeight},encodeHtml:function(a){return b.createElement("a").appendChild(b.createTextNode(a)).parentNode.innerHTML},text:function(a,b){if(b)a.textContent&&"undefined"!=typeof a.textContent?a.textContent=b:a.innerText=b;else{if(a.innerText)return c.trim(a.innerText);if(a.textContent)return c.trim(a.textContent);if(a.data)return c.trim(a.data)}return""},changeTag:function(a,c){var d,e,f=b.createElement(c);for(d=a.firstChild;d;)e=d.nextSibling,f.appendChild(d),d=e;return a.parentNode.insertBefore(f,a),a.parentNode.removeChild(a),f},detachNode:function(a){return null!==a.parentNode&&a.parentNode.removeChild(a),a},baseAtCaret:function(b){if(!b.isActive())return null;var c=a.getSelection?a.getSelection():document.selection;if(c.rangeCount){var d=c.getRangeAt(0),e=d.endContainer;switch(e.nodeType){case 3:if(e.data&&e.data.length!=d.endOffset)return!1}return e}return null},atCaret:function(a){var b=this.baseAtCaret(a)||{},c=a.element;if(b===!1)return null;for(;b&&b.parentNode!==c;)b=b.parentNode;return b&&1==b.nodeType?b:null},hide:function(a){a.style.display="none"},show:function(a){a.style.display=""},hideAnim:function(a){a.style.opacity=1},showAnim:function(a){a.style.opacity=.01,a.style.display=""}},h.Selection=function(){},h.Selection.prototype={setBridge:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},saveSelection:function(){if(a.getSelection){var c=a.getSelection();if(c.rangeCount>0)return c.getRangeAt(0)}else if(b.selection&&b.selection.createRange)return b.selection.createRange();return null},restoreSelection:function(c){if(c)if(a.getSelection){var d=a.getSelection();d.removeAllRanges(),d.addRange(c)}else b.selection&&c.select&&c.select()}},h.Cursor=function(){},h.Cursor.prototype={setBridge:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},set:function(d,e,f){{var g;this.html}if(b.createRange){var h=a.getSelection(),i=d.lastChild(),j=c.text(i).length-1,k=f?f:i,l="undefined"!=typeof e&&null!==e?e:j;g=b.createRange(),g.setStart(k,l),g.collapse(!0),h.removeAllRanges(),h.addRange(g)}else g=b.body.createTextRange(),g.moveToElementText(f),g.collapse(!1),g.select()},parent:function(){var c,d=null;return a.getSelection?(c=a.getSelection().getRangeAt(0),d=c.commonAncestorContainer,d=1===d.nodeType?d:d.parentNode):b.selection&&(d=b.selection.createRange().parentElement()),"SPAN"==d.tagName&&(d=d.parentNode),d},caretToBeginning:function(a){this.set(this,0,a)},caretToEnd:function(a){this.set(this,c.text(a).length,a)}},h.Toolbar=function(d,e){var f=b.createElement("div"),g=this;f.innerHTML=this.html,this.buttons=e,this.element=f.children[0],b.body.appendChild(this.element),this.active=!1,this.busy=!0,c.addEvents(document,"mouseup keyup",function(){h.activeElement!==d.element||g.busy||g.goToSelection()}).addEvent(a,"scroll",function(){g.active&&g.goToSelection()})},h.Toolbar.prototype={fixedClass:"Medium-toolbar-fixed",showClass:"Medium-toolbar-show",hideClass:"Medium-toolbar-hide",html:'<div class="Medium-toolbar">	<div class="Medium-tail-outer">		<div class="Medium-tail-inner"></div>	</div>	<div id="Medium-buttons"></div>	<table id="Medium-options">		<tbody>			<tr>			</tr>		</tbody>	</table></div>',goToSelection:function(){var b=this.getHighlighted(),d=b.boundary.top-5,e=this.element,f=e.style;a.scrollTop>0?c.addClass(e,this.fixedClass):c.removeClass(e,this.fixedClass),null!==b&&(b.range.startOffset!==b.range.endOffset||b.text?(c.removeClass(e,this.hideClass).removeClass(e,this.showClass),f.opacity=.01,c.addClass(e,this.showClass),f.opacity=1,f.top=d-65+"px",f.left=b.boundary.left+b.boundary.width/2-e.clientWidth/2+"px",this.active=!0):(c.removeClass(e,this.showClass).addClass(e,this.hideClass),this.active=!1))},getHighlighted:function(){var b=a.getSelection(),d=b.anchorNode?b.getRangeAt(0):!1;return d?{selection:b,range:d,text:c.trim(d.toString()),boundary:d.getBoundingClientRect()}:null}},h.Drag=function(d){this.medium=d;var e=this,f=this.iconSrc.replace(/[{][{]([a-zA-Z]+)[}][}]/g,function(a,b){return e.hasOwnProperty(b)?e[b]:a}),g=this.icon=b.createElement("img");g.className=this.buttonClass,g.setAttribute("contenteditable","false"),g.setAttribute("src",f),this.hide(),this.element=null,this.protectedElement=null,c.addEvent(g,"dragstart",function(b){null===e.protectedElement&&(b=b||a.event,e.protectedElement=c.detachNode(e.element),e.icon.style.opacity=0)}).addEvent(g,"mouseover",function(a){null===e.protectedElement&&c.stopPropagation(a).addClass(e.element,e.elementClass)}).addEvent(g,"mouseout",function(a){null===e.protectedElement&&c.stopPropagation(a).removeClass(e.element,e.elementClass)}).addEvent(g,"dragend",b.body.ondragend=function(){null!==e.protectedElement&&setTimeout(function(){e.cleanCanvas(),e.protectedElement=null},1)})},h.Drag.prototype={elementClass:"Medium-focused",buttonClass:"Medium-drag",iconSrc:'data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="21.424px" height="21.424px" viewBox="0 0 21.424 21.424" style="enable-background:new 0 0 21.424 21.424;" xml:space="preserve">	<g>		<g>			<path style="fill:{{iconColor}};" d="M13.616,17.709L13.616,17.709h0.781l-3.686,3.715l-3.685-3.715h0.781l0,0H13.616z M13.616,17.709 M14.007,17.709 M12.555,19.566 M8.87,19.566 M7.418,17.709 M7.809,17.709 M10.712,17.709"/>			<path style="fill:{{iconColor}};" d="M13.616,3.715L13.616,3.715h0.781L10.712,0L7.027,3.715h0.781l0,0H13.616z M13.616,3.715 M14.007,3.715 M12.555,1.858 M8.87,1.858 M7.418,3.715 M7.809,3.715 M10.712,3.715"/>			<path style="fill:{{iconColor}};" d="M3.716,13.616L3.716,13.616v0.781L0,10.712l3.716-3.685v0.781l0,0V13.616z M3.716,13.616 M3.716,14.007 M1.858,12.555 M1.858,8.87 M3.716,7.417 M3.716,7.808 M3.716,10.712"/>			<path style="fill:{{iconColor}};" d="M17.709,13.616L17.709,13.616v0.781l3.715-3.685l-3.715-3.685v0.781l0,0V13.616z M17.709,13.616 M17.709,14.007 M19.566,12.555 M19.566,8.87 M17.709,7.417 M17.709,7.808 M17.709,10.712"/>		</g>		<path style="fill-rule:evenodd;clip-rule:evenodd;fill:{{iconColor}};" d="M10.712,6.608c2.267,0,4.104,1.838,4.104,4.104 c0,2.266-1.837,4.104-4.104,4.104c-2.266,0-4.104-1.837-4.104-4.104C6.608,8.446,8.446,6.608,10.712,6.608L10.712,6.608z M10.712,7.515c-1.765,0-3.196,1.432-3.196,3.197s1.432,3.197,3.196,3.197c1.766,0,3.197-1.432,3.197-3.197 S12.478,7.515,10.712,7.515z"/>	</g></svg>',iconColor:"#231F20",hide:function(){c.hide(this.icon)},show:function(a){if(a!==this.icon||null!==this.protectedElement){this.element=a;var b=this.icon.style,d=a.offsetLeft,e=a.offsetTop;a.dragIcon=this.icon,a.parentNode.appendChild(this.icon),b.opacity=1,b.left=d+"px",b.top=e+"px",c.show(this.icon)}},cleanCanvas:function(){var a,d=!1,e=b.getElementsByClassName(this.buttonClass);for(this.icon.style.opacity=1;e.length>0;)c.isVisible(a=e[0])&&(d||(a.parentNode.insertBefore(this.element,a),d=!0),c.detachNode(a));c.detachNode(this.icon)}},h.Action=function(){},h.Action.prototype={setBridge:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},listen:function(){var a=this.element,b=this.intercept;c.addEvent(a,"keyup",b.up).addEvent(a,"keydown",b.down).addEvent(a,"focus",b.focus).addEvent(a,"blur",b.blur).addEvent(a,"paste",this.settings.pasteEventHandler)},preserveElementFocus:function(){var c=a.getSelection?a.getSelection().anchorNode:b.activeElement;if(c){var d,e=this.medium.cache,f=this.settings,g=c.parentNode,h=f.element.children,i=g!==e.focusedElement,j=0;for(g===f.element&&(g=c),d=0;d<h.length;d++)if(g===h[d]){j=d;break}i&&(e.focusedElement=g,e.focusedElementIndex=j)}}},h.Cache=function(){this.initialized=!1,this.cmd=!1,this.focusedElement=null},h.Cache.prototype={setBridge:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}},h.inlineMode="inline",h.partialMode="partial",h.richMode="rich",h.inlineRichMode="inlineRich",h.Messages={pastHere:"Paste Here"},h.domesticatedBehavior="domesticated",h.wildBehavior="wild",h}();"function"==typeof define&&define.amd?define(function(){return c}):"undefined"!=typeof module&&module.exports?module.exports=c:"undefined"!=typeof this&&(this.Medium=c)}).call(this,window,document),jQuery(document).ready(function(a){var b=aesop_editor.editor;a("#aesop-editor--edit").click(function(c){c.preventDefault(),a(b).attr("contenteditable",!0),new Medium({element:document.getElementById("aesop-editor--content")})})}),jQuery(document).ready(function(a){var b=aesop_editor.ajaxurl,c=aesop_editor.editor,d=aesop_editor.confirm;a("#aesop-editor--save").live("click",function(e){e.preventDefault();var f=a(this),g=a(c).html(),h={action:"process_save_content",author:aesop_editor.author,content:g,post_id:f.data("post-id"),nonce:aesop_editor.nonce};a.post(b,h,function(b){a(d).text("success"==b?"success":"error")})})});